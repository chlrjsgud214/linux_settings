
---

# ğŸ“ AI Edge ê°œë°œ í™˜ê²½ êµ¬ì¶• ê°€ì´ë“œ (WSL2 + USB Camera)

## **1. Windows í˜¸ìŠ¤íŠ¸ ì„¤ì • (USB ì—°ê²°)**

WSL2ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ USB ì¥ì¹˜ë¥¼ ì§ì ‘ ì¸ì‹í•˜ì§€ ëª»í•©ë‹ˆë‹¤. ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ì˜ `usbipd-win` ë„êµ¬ë¥¼ í†µí•´ USB ì—°ê²°ì„ 'í„°ë„ë§' í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

### **1-1. ë„êµ¬ ì„¤ì¹˜ (Windows PowerShell ê´€ë¦¬ì ê¶Œí•œ)**

```powershell
winget install usbipd-win

```

*(ì„¤ì¹˜ í›„ ì¬ë¶€íŒ… ê¶Œì¥)*

### **1-2. ì¹´ë©”ë¼ ì—°ê²° (ë§¤ë²ˆ ì¬ë¶€íŒ… ì‹œ í•„ìš”)**

1. **[PowerShell ê´€ë¦¬ì]** ì‹¤í–‰
2. USB ëª©ë¡ í™•ì¸ ë° Bus ID ì°¾ê¸°
```powershell
usbipd list

```


3. WSLë¡œ ì¹´ë©”ë¼ ì—°ê²° (Bus IDê°€ 1-1ì¸ ê²½ìš°)
```powershell
# ì´ë¯¸ ì—°ê²°ëœ ìƒíƒœë©´ ëŠê³  ë‹¤ì‹œ ì—°ê²° (ì´ˆê¸°í™”)
usbipd detach --busid 1-1
usbipd attach --wsl --busid 1-1

```



---

## **2. WSL2(Ubuntu) ë¦¬ëˆ…ìŠ¤ ì„¤ì •**

ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì´ USB ì¹´ë©”ë¼ ë“œë¼ì´ë²„ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

### **2-1. í•„ìˆ˜ ë“œë¼ì´ë²„ ì„¤ì¹˜**

```bash
sudo apt update
sudo apt install linux-tools-virtual hwdata
sudo update-alternatives --install /usr/local/bin/usbip usbip /usr/lib/linux-tools/*/usbip 20

```

### **2-2. ì¹´ë©”ë¼ ì¥ì¹˜ ê¶Œí•œ ì„¤ì •**

ì¹´ë©”ë¼ê°€ ì—°ê²°ë˜ë©´ `/dev/video0` íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤. ì´ íŒŒì¼ì— ì ‘ê·¼ ê¶Œí•œì„ ì¤ë‹ˆë‹¤.

```bash
# ì¹´ë©”ë¼ ì—°ê²° í™•ì¸
ls -l /dev/video*

# ê¶Œí•œ ë¶€ì—¬ (ë§¤ë²ˆ ì—°ê²° ì‹œ í•„ìš”í•  ìˆ˜ ìˆìŒ)
sudo chmod 777 /dev/video0

```

### **2-3. í•œê¸€ í°íŠ¸ ì„¤ì¹˜ (OCR ê²°ê³¼ í™”ë©´ í‘œì‹œìš©)**

```bash
sudo apt install fonts-nanum -y

```

---

## **3. Python ê°€ìƒí™˜ê²½ (Conda) êµ¬ì¶•**

ì‹œìŠ¤í…œ íŒŒì´ì¬ì„ ë”ëŸ½íˆì§€ ì•Šê¸° ìœ„í•´ Conda ê°€ìƒí™˜ê²½ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

### **3-1. Miniconda ì„¤ì¹˜**

```bash
mkdir -p ~/miniconda3
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh
bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3
rm -rf ~/miniconda3/miniconda.sh
~/miniconda3/bin/conda init bash
source ~/.bashrc

```

### **3-2. ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”**

* **Python 3.8**ì´ í˜¸í™˜ì„±(Paddle, ONNX ë“±)ì´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤.

```bash
# í™˜ê²½ ì´ë¦„: ai_edge, íŒŒì´ì¬ ë²„ì „: 3.8
conda create -n ai_edge python=3.8 -y

# í™œì„±í™”
conda activate ai_edge

```

---

## **4. í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜**

ê°€ì¥ ì•ˆì •ì ì´ê³  ì¶©ëŒì´ ì—†ëŠ” ì¡°í•©ì…ë‹ˆë‹¤. (PaddleOCR, EasyOCRì˜ ë‹¨ì ì„ ëª¨ë‘ í•´ê²°í•œ ìµœì¢…ì•ˆ)

### **4-1. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜**

```bash
# 1. ê¸°ë³¸ ì—°ì‚° ë° ì´ë¯¸ì§€ ì²˜ë¦¬
pip install numpy opencv-python

# 2. YOLO (ê°ì²´ ì¸ì‹ - GPU ê°€ì† ìë™ ì§€ì›)
pip install ultralytics

# 3. RapidOCR (ê¸€ì ì¸ì‹ - ONNX ëŸ°íƒ€ì„ ê¸°ë°˜, ë¹ ë¥´ê³  ì•ˆì •ì )
pip install rapidocr_onnxruntime

```

### **4-2. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… (GUI ì—ëŸ¬ ë°©ì§€)**

`opencv-python-headless`ê°€ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ `cv2.imshow` ì°½ì´ ëœ¨ì§€ ì•ŠìŠµë‹ˆë‹¤. í™•ì¸ ì‚¬ì‚´í•©ë‹ˆë‹¤.

```bash
pip uninstall opencv-python-headless -y
pip install opencv-python

```

---

## **5. ìµœì¢… ê²€ì¦ëœ ì†ŒìŠ¤ ì½”ë“œ**

ì•„ë˜ ì½”ë“œëŠ” ë‹¤ìŒ ë¬¸ì œë“¤ì„ ëª¨ë‘ í•´ê²°í•œ ìµœì¢… ë²„ì „ì…ë‹ˆë‹¤.

1. **USB ëŒ€ì—­í­ ì´ˆê³¼(Timeout) í•´ê²°:** MJPG í¬ë§· ê°•ì œ ì ìš©
2. **ì¸ì‹ë¥  ì €í•˜ í•´ê²°:** í•´ìƒë„ 720p ìƒí–¥, íŒ¨ë”©(Padding) ì „ì²˜ë¦¬ ì ìš©
3. **ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶©ëŒ í•´ê²°:** RapidOCR ê¸°ë³¸ ëª¨ë¸(Default) ì‚¬ìš©

**íŒŒì¼ëª…: `main_system.py**`

```python
import cv2
import numpy as np
import re
from ultralytics import YOLO
from rapidocr_onnxruntime import RapidOCR
import warnings

warnings.filterwarnings("ignore")

# [ì „ì²˜ë¦¬] ì¸ì‹ë¥  í–¥ìƒì„ ìœ„í•œ ì´ë¯¸ì§€ ë³´ì •
def preprocess_image(img):
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    # ê¸€ìê°€ ê½‰ ì°¨ì„œ ì¸ì‹ ì•ˆ ë˜ëŠ” ê²ƒì„ ë°©ì§€ (ì—¬ë°± ì¶”ê°€)
    padding = 20
    padded = cv2.copyMakeBorder(gray, padding, padding, padding, padding, cv2.BORDER_CONSTANT, value=255)
    # ì‘ì€ ê¸€ì”¨ë¥¼ ìœ„í•´ 2ë°° í™•ëŒ€
    upscaled = cv2.resize(padded, None, fx=2.0, fy=2.0, interpolation=cv2.INTER_LINEAR)
    return upscaled

# [í›„ì²˜ë¦¬] íŠ¹ìˆ˜ë¬¸ì ë…¸ì´ì¦ˆ ì œê±°
def clean_text(text):
    # ì˜ë¬¸, ìˆ«ì, ì¼ë¶€ ê¸°í˜¸(- :)ë§Œ í—ˆìš©
    cleaned = re.sub(r'[^a-zA-Z0-9\-\: ]', '', text)
    return cleaned.strip()

def main():
    print("ğŸš€ AI Edge System Started (YOLO + RapidOCR)")
    
    # 1. YOLO ë¡œë“œ
    try:
        yolo_model = YOLO('runs/detect/train/weights/best.pt') # í•™ìŠµëœ ëª¨ë¸ì´ ìˆë‹¤ë©´
    except:
        yolo_model = YOLO('yolov8n.pt') # ì—†ìœ¼ë©´ ê¸°ë³¸ ëª¨ë¸

    # 2. OCR ë¡œë“œ (ê¸°ë³¸ ëª¨ë¸ ì‚¬ìš© -> ìë™ ë‹¤ìš´ë¡œë“œë¨)
    ocr = RapidOCR() 

    # 3. ì¹´ë©”ë¼ ì„¤ì • (í•µì‹¬: MJPG + í•´ìƒë„ UP)
    cap = cv2.VideoCapture(0, cv2.CAP_V4L2)
    cap.set(cv2.CAP_PROP_FOURCC, cv2.VideoWriter_fourcc('M', 'J', 'P', 'G'))
    cap.set(cv2.CAP_PROP_FRAME_WIDTH, 1280)
    cap.set(cv2.CAP_PROP_FRAME_HEIGHT, 720)
    cap.set(cv2.CAP_PROP_FPS, 30)
    cap.set(cv2.CAP_PROP_BUFFERSIZE, 1)

    print(f"âœ… Camera Ready: {cap.get(3)}x{cap.get(4)}")
    
    last_text = ""
    trigger = False

    while True:
        ret, frame = cap.read()
        if not ret: continue

        # í‚¤ ì…ë ¥ (Space: ì¸ì‹, Q: ì¢…ë£Œ)
        key = cv2.waitKey(1) & 0xFF
        if key == ord('q'): break
        elif key == ord(' '): trigger = True

        # YOLO ì¶”ë¡ 
        results = yolo_model(frame, device=0, verbose=False, conf=0.6)

        for box in results[0].boxes:
            x1, y1, x2, y2 = map(int, box.xyxy[0])
            cv2.rectangle(frame, (x1, y1), (x2, y2), (0, 255, 0), 2)

            if trigger:
                # ë°•ìŠ¤ ì˜ì—­ ì¶”ì¶œ (ì¢Œí‘œ ì•ˆì „ ì²˜ë¦¬)
                h, w, _ = frame.shape
                cx1, cy1 = max(0, x1), max(0, y1)
                cx2, cy2 = min(w, x2), min(h, y2)
                cropped = frame[cy1:cy2, cx1:cx2]

                if cropped.size > 0:
                    try:
                        # ì „ì²˜ë¦¬ ë° OCR
                        processed = preprocess_image(cropped)
                        ocr_result, _ = ocr(processed)
                        
                        if ocr_result:
                            valid_texts = []
                            for item in ocr_result:
                                # ê²°ê³¼ íŒŒì‹± ì•ˆì „ì¥ì¹˜
                                if isinstance(item, (list, tuple)) and len(item) >= 2:
                                    text = item[1] if isinstance(item[1], str) else item[0]
                                    clean = clean_text(text)
                                    if len(clean) >= 2:
                                        valid_texts.append(clean)
                            
                            if valid_texts:
                                last_text = " ".join(valid_texts)
                                print(f"âœ… [Result] {last_text}")
                            else:
                                print("âš ï¸ No valid text")
                        else:
                            print("âš ï¸ No text found")
                    except Exception as e:
                        print(f"âŒ Error: {e}")

            if last_text:
                cv2.rectangle(frame, (x1, y1-30), (x1 + len(last_text)*15, y1), (0,0,0), -1)
                cv2.putText(frame, last_text, (x1, y1 - 10), 
                            cv2.FONT_HERSHEY_SIMPLEX, 0.7, (255, 255, 255), 2)

        if trigger: trigger = False
        
        # ë³´ê¸° í¸í•˜ê²Œ í™”ë©´ ë¦¬ì‚¬ì´ì¦ˆ (ì¸ì‹ì€ ì›ë³¸ ê³ í™”ì§ˆë¡œ í•¨)
        display = cv2.resize(frame, (800, 450))
        cv2.imshow("AI System", display)

    cap.release()
    cv2.destroyAllWindows()

if __name__ == "__main__":
    main()

```

---

## **6. ìì£¼ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì™€ í•´ê²°ì±… (FAQ)**

| ì—ëŸ¬ ë©”ì‹œì§€ | ì›ì¸ | í•´ê²°ì±… |
| --- | --- | --- |
| `select() timeout` | USB ëŒ€ì—­í­ ì´ˆê³¼ | ì½”ë“œì˜ `fourcc`ë¥¼ **MJPG**ë¡œ ì„¤ì • (`cap.set`) |
| `can't open camera` | ì—°ê²° ëŠê¹€ | ìœˆë„ìš° PowerShellì—ì„œ `usbipd attach` ë‹¤ì‹œ ì‹¤í–‰ |
| `Segmentation fault` | ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶©ëŒ | `Shapely` ì¬ì„¤ì¹˜ ë˜ëŠ” **RapidOCR**ë¡œ êµì²´ (í˜„ì¬ ì ìš©ë¨) |
| `IndexError: list index` | ì‚¬ì „ íŒŒì¼ ë¶ˆì¼ì¹˜ | ì»¤ìŠ¤í…€ ì‚¬ì „ ì“°ì§€ ë§ê³  **ê¸°ë³¸ ëª¨ë¸(Default)** ì‚¬ìš© |
| `nshzz...` (ì•”í˜¸ë¬¸) | ì‚¬ì „ ìˆœì„œ ê¼¬ì„ | ìœ„ì™€ ë™ì¼ (ê¸°ë³¸ ëª¨ë¸ ì‚¬ìš© ì‹œ í•´ê²°ë¨) |

